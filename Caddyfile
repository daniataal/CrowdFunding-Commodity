{
    # Enable debug logs for troubleshooting
    debug
}

# Use the DOMAIN_NAME env var (e.g. 151.145.85.174)
https://{$DOMAIN_NAME} {
    # internal = Self-Signed info (for Raw IP support)
    tls internal

    # Route /marketplace to the Marketplace Platform (Port 3001)
    handle /marketplace* {
        reverse_proxy marketplace_app:3001
    }

    # Route /crowdfunding to the Crowdfunding App (Port 3000)
    handle /crowdfunding* {
        reverse_proxy app:3000
    }

    # Redirect root to /crowdfunding
    handle / {
        redir /crowdfunding
    }
}

# Fallback/Redirect for standard HTTP
:80 {
    # Optional: Redirect to HTTPS if you want to force it
    # redir https://{host}{uri}
    
    # For now, just confirm it works
    respond "HTTP is running. Access via HTTPS at https://{$DOMAIN_NAME} (Accept Security Warning)"
}
